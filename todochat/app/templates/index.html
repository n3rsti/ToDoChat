{% extends "base.html" %}
{% load static %}
{% block extra_head %}
    <script>
        $(document).ready(function () {
            // If user has no tasks. #tasks element won't be displayed
            // so prev/next month section can be shown all the time
            if (document.querySelector("#tasks") !== null) {
                let taskSectionPos;
                let winHeight = window.innerHeight;
                window.addEventListener('resize', () => {
                    // Update winHeight when user changes window size
                    winHeight = window.innerHeight;
                });
                $(window).scroll(function () {
                    taskSectionPos = winHeight - document.querySelector("#tasks").getBoundingClientRect().top;
                    if (taskSectionPos > 60) {
                        $(".change_calendar_date").css("transform", "scale(0)");
                    } else {
                        $(".change_calendar_date").css("transform", "scale(1)");
                    }
                });
            }
        });

    </script>
{% endblock extra_head %}
{% block title %}
    <title>ToDoChat</title>
{% endblock title %}
{% block content %}
    {% include "app_base.html" %}
    <main class="content">
        {{ calendar }}
        {% if request.user.users_tasks.count > 0 %}
            <h2 class="text-center" id="tasks">Closest to deadline</h2>
            <ul class="task__list">
                {% for task in today_tasks %}
                    <li class="task__li {% if forloop.last %}mb-3{% endif %}">
                        <article class="task">
                            <section class="task__top">
                                <a href="{% url 'task_detail' task.server.id task.id %}"><strong>{{ task.server.name }}#{{ task.task_id }}</strong> {{ task.title }}
                                </a>
                                <div class="top__users task_status_section task_status_section--center">
                                    {% if task.status == "open" %}
                                        <span class="badge open">Open</span>
                                    {% elif task.status == "approved" %}
                                        <span class="badge bg-success">Approved</span>
                                    {% elif task.status == "need_more_work" %}
                                        <span class="badge bg-warning">Need more work</span>
                                    {% elif task.status == "submitted_for_review" %}
                                        <span class="badge bg-success">Submitted</span>
                                    {% endif %}
                                </div>
                            </section>
                            <section class="task__date">
                                {% if task.deadline %}
                                    Deadline:
                                    {{ task.deadline|date:"d M, Y" }},
                                {% else %}
                                    No deadline,
                                {% endif %}
                                by
                                <a href="{% url 'user_detail' task.author %}">{{ task.author }}</a>
                            </section>
                        </article>
                    </li>
                {% endfor %}
            </ul>
        {% endif %}
    </main>
{% endblock content %}